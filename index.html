 <!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Artera Company Map</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <!-- Mapbox GL JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <!-- Geocoder plugin -->
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
  <link
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css"
    rel="stylesheet" />
  <style>
    body, html { margin:0; padding:0; height:100%; }
    #map { position:absolute; top:0; bottom:0; width:100%; }
    .mapboxgl-popup-content { font:14px/1.5 Arial, sans-serif; }
    /* Legend & Controls */
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 4px;
      font-family: Arial, sans-serif;
      font-size: 13px;
      z-index: 1;
    }
    #controls b { display: block; margin-bottom: 5px; }
    #controls label { display: block; margin-bottom: 3px; }
  </style>
</head>
<body>
<div id="controls">
  <b>Filter by Union Status</b>
  <label><input type="checkbox" id="unionChk" checked> Union</label>
  <label><input type="checkbox" id="nonUnionChk" checked> Non-Union</label>
</div>
<div id="map"></div>
<script>
  // Your Mapbox token
  mapboxgl.accessToken = 'pk.eyJ1IjoibXJzaGFyZXBvaW50IiwiYSI6ImNtZHlwcWdmeTA0cG4yam9peGhhNXg0YXQifQ.JnHCLctXF8nC6rOGmWYd5A';

  // Bounds for continental USA
  const usaBounds = [[-125.0, 24.396308], [-66.885444, 49.384358]];

  // Initialize map
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/light-v10',
    bounds: usaBounds,
    fitBoundsOptions: { padding: 20 },
    maxBounds: usaBounds,
    projection: 'mercator'
  });

  // Add geocoder (search box)
  const geocoder = new MapboxGeocoder({ accessToken: mapboxgl.accessToken, mapboxgl });
  map.addControl(geocoder, 'top-left');

  map.on('load', () => {
    // Load GeoJSON with clustering enabled
    map.addSource('locations', {
      type: 'geojson',
      data: 'locationdata.geojson',
      cluster: true,
      clusterMaxZoom: 14,
      clusterRadius: 50
    });

    // Cluster circles
    map.addLayer({
      id: 'clusters',
      type: 'circle',
      source: 'locations',
      filter: ['has', 'point_count'],
      paint: {
        'circle-color': '#FFA500',
        'circle-radius': ['step', ['get', 'point_count'], 15, 5, 20, 10, 25]
      }
    });

    // Cluster count labels
    map.addLayer({
      id: 'cluster-count',
      type: 'symbol',
      source: 'locations',
      filter: ['has', 'point_count'],
      layout: {
        'text-field': '{point_count_abbreviated}',
        'text-font': ['Arial Unicode MS Bold'],
        'text-size': 12
      }
    });

    // Unclustered points
    map.addLayer({
      id: 'unclustered-points',
      type: 'circle',
      source: 'locations',
      filter: ['!', ['has', 'point_count']],
      paint: {
        'circle-radius': 6,
        'circle-color': [
          'match', ['get', 'union'],
          'Union', '#1f77b4',
          'Non-Union', '#9467bd',
          '#888'
        ],
        'circle-stroke-width': 1,
        'circle-stroke-color': '#ffffff'
      }
    });

    // Popup on click
    map.on('click', 'unclustered-points', e => {
      const p = e.features[0].properties;
      new mapboxgl.Popup({ maxWidth: '300px' })
        .setLngLat(e.lngLat)
        .setHTML(
          `<strong>Company:</strong> ${p.company}<br>` +
          `<strong>Union:</strong> ${p.union}<br>` +
          `<strong>Contact:</strong> ${p.contact}<br>` +
          `<strong>Phone:</strong> ${p.phone}<br>` +
          `<strong>Email:</strong> <a href="mailto:${p.email}">${p.email}</a><br>` +
          `<strong>State:</strong> ${p.state}`
        )
        .addTo(map);
    });

    // Change cursor
    map.on('mouseenter', 'unclustered-points', () => map.getCanvas().style.cursor = 'pointer');
    map.on('mouseleave', 'unclustered-points', () => map.getCanvas().style.cursor = '');

    // Filter function
    function applyFilters() {
      const showU = document.getElementById('unionChk').checked;
      const showN = document.getElementById('nonUnionChk').checked;
      const filter = ['all', ['!', ['has', 'point_count']], [
        'any',
        showU && ['==', ['get', 'union'], 'Union'],
        showN && ['==', ['get', 'union'], 'Non-Union']
      ].filter(Boolean)];
      map.setFilter('unclustered-points', filter);
    }

    // Attach filter events
    document.getElementById('unionChk').addEventListener('change', applyFilters);
    document.getElementById('nonUnionChk').addEventListener('change', applyFilters);
  });
</script>
</body>
</html>
